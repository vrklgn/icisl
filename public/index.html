<html>
  <head>
  <link rel="stylesheet" href="style.css" type="text/css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Jersey+10&display=swap" rel="stylesheet">
</head>
  <body>
  <div id="header">
    <p></p>
  <div id="content">
<html>
<head>
    <title>Is Corporate IT still living?</title>
</head>
<body>
    <p id="result"></p>
  <div id="location"></div>
  <p id="cordinates"></p>
    <p id="time"></p>
    <p id="distance"></p>
    

   <script>
// START GENAI@CHATGPT4

        function haversine(lat1, lon1, lat2, lon2) {
        function toRad(x) {
            return x * Math.PI / 180;
        }

        var R = 6371; // km
        var dLat = toRad(lat2 - lat1);
        var dLon = toRad(lon2 - lon1);
        var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
            Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
            Math.sin(dLon / 2) * Math.sin(dLon / 2);
        var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        var d = R * c;
        return d;
    }

document.addEventListener("DOMContentLoaded", function() {
    fetch('/fetch-feed')
        .then(response => response.json())
        .then(data => {
            console.log(data);

            document.getElementById('cordinates').textContent = "@ " + data.lat+" , "+data.long;
            document.getElementById('time').textContent = data.time;
            
             // Convert the time string to a Date object
            const feedTime = new Date(data.time);
            feedTime.setHours(feedTime.getHours() + 2);
            
            // Convert the Date object to ISO 8601 format
            const isoTime = feedTime.toISOString();
            
            document.getElementById('time').textContent = isoTime;
            
            // Get the current date and time
            const now = new Date();

            // Calculate the difference in milliseconds
            const diff = now - feedTime;

            // Convert the difference to hours
            const hours = diff / 1000 / 60 / 60;

            // Determine the result
            const result = hours <= 4 ? 'Yes, Still Alive!' : 'Maybe...';

            // Display the result
            document.getElementById('result').textContent = result;

             const fixedLat = 67.90046969145193;
            const fixedLong = 18.51645419943535;
            const distance = haversine(data.lat, data.long, fixedLat, fixedLong);
            document.getElementById('distance').textContent = 'Distance Left: ' + distance.toFixed(2) + ' km';

            // Fetch the image from your server
            fetch(`/map-image?lat=${data.lat}&long=${data.long}`)
                .then(response => response.json())
                .then(imageData => {
                    // Create an img element
                    const img = document.createElement('img');
                    img.src = imageData.image;
                    
                    // Append the img element to the div with the id "location"
                    document.getElementById('location').appendChild(img);
                }).catch(error => console.error('Error:', error));
        })
        .catch((error) => {
            console.error('Error:', error);
        });
});
// END GENAI@CHATGPT4
</script>
  </div>
  </div>
  </body>
</html>
