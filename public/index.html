<html>
  <head>
  <link rel="stylesheet" href="style.css" type="text/css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Jersey+10&display=swap" rel="stylesheet">
</head>
  <body>
  <div id="header">
    <p></p>
  <div id="content">
<html>
<head>
    <title>Is Corporate IT still living?</title>
</head>
<body>
    <h1>Is Corporate IT still living?</h1>

    <p id="result"></p>
  <div id="location"></div>
    <p>Last Seen</p>
    <p id="time"></p>
    <p id="latitude"></p>
    <p id="longitude"></p>

    <script>
    document.addEventListener("DOMContentLoaded", function() {
        fetch('/fetch-feed')
            .then(response => response.json())
            .then(data => {
                console.log(data);

                document.getElementById('latitude').textContent = 'Latitude: ' + data.lat;
                document.getElementById('longitude').textContent = 'Longitude: ' + data.long;
                document.getElementById('time').textContent = data.time;
                
                 // Convert the time string to a Date object
                const feedTime = new Date(data.time);
                
                // Convert the Date object to ISO 8601 format
                const isoTime = feedTime.toISOString();
                
                document.getElementById('time').textContent = isoTime;
                
                // Get the current date and time
                const now = new Date();

                // Calculate the difference in milliseconds
                const diff = now - feedTime;

                // Convert the difference to hours
                const hours = diff / 1000 / 60 / 60;

                // Determine the result
                const result = hours <= 4 ? 'YES' : 'Maybe';

                // Display the result
                document.getElementById('result').textContent = result;

                // Fetch the image from your server
                const imageUrl = `/map-image?lat=${data.lat}&long=${data.long}`;
                
                // Create an img element
                const img = document.createElement('img');
                img.src = imageUrl;
                
                // Append the img element to the div with the id "location"
                document.getElementById('location').appendChild(img);

            })
            .catch((error) => {
                console.error('Error:', error);
            });
    });
    </script>
  </div>
  </div>
  </body>
</html>
